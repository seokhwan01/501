<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Self Driving Car - Control UI</title>
<style>
/* ğŸ¨ ë‹¤í¬ í…Œë§ˆ ì „ì²´ ìŠ¤íƒ€ì¼ */
:root {
  color-scheme: dark;
}

body {
  background: #111;         /* ì „ì²´ ë°°ê²½ */
  color: #eee;              /* ê¸°ë³¸ ê¸€ììƒ‰ */
  font-family: sans-serif;  /* ê¸°ë³¸ ê¸€ê¼´ */
  margin: 0;
}

/* ğŸ“¦ ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
.wrap {
  max-width: 900px;
  margin: 1rem auto;
  padding: 0 1rem;
}

/* ğŸ—‚ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.card {
  background: #1b1b1b;
  border-radius: 12px;
  padding: 1rem;
  margin-bottom: 1rem;
}

/* ì œëª© */
h2 {
  margin: 0.2rem 0 0.8rem 0;
}

/* ì˜ìƒ ì´ë¯¸ì§€ */
img {
  width: 100%;
  border-radius: 8px;
  display: block;
}

/* ğŸ”˜ ì˜¤ë¥¸ìª½ ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ */
.top-right {
  position: fixed;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 8px;
  z-index: 10;
}

/* ë²„íŠ¼ ê³µí†µ */
.btn {
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.35);
  transition: 0.2s ease-in-out;
}

/* ë²„íŠ¼ ìƒ‰ìƒ */
.btn-backward {
  background: #007bff; /* íŒŒë‘ */
  color: #fff;
}
.btn-stop {
  background: #d7263d; /* ë¹¨ê°• */
  color: #fff;
}
.btn-resume {
  background: #2bb673; /* ì´ˆë¡ */
  color: #101010;
}

/* ë²„íŠ¼ hover íš¨ê³¼ */
.btn:hover {
  opacity: 0.85;
}

/* í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì•ˆë‚´ */
kbd {
  background: #222;
  border-radius: 6px;
  padding: 2px 6px;
}

/* ë„ì›€ë§ í…ìŠ¤íŠ¸ */
.help {
  color: #bbb;
  font-size: 0.9rem;
  margin-top: 0.8rem;
}
</style>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
<!-- ğŸ”˜ ìƒë‹¨ ë²„íŠ¼ -->
<div class="top-right">
  <button id="btnBackward" class="btn btn-backward">BACKWARD</button>
  <button id="btnStop" class="btn btn-stop">START</button>
</div>

<!-- ğŸ“¦ ë©”ì¸ ì˜ì—­ -->
<div class="wrap">
  <div class="card">
    <h2>ìš´ì „ì ì‹œì </h2>
    <!-- ğŸ”¥ ì˜ìƒ í‘œì‹œ -->
    <img id="videoStream" src="" alt="Video Stream">

    <div class="help">
      í‚¤ë³´ë“œ: <kbd>â†/â†’</kbd> íšŒì „, <kbd>â†‘/â†“</kbd> ì†ë„, 
      <kbd>Space</kbd> ì •ì§€/ì¬ê°œ, <kbd>B</kbd> í›„ì§„, <kbd>Q</kbd> ì¢…ë£Œ
    </div>
  </div>
</div>

<script>
const socket = io();

// ğŸ”¥ ì„œë²„ì—ì„œ ì˜¤ëŠ” ì˜ìƒ ì²˜ë¦¬
socket.on("video_broadcast", (frameBytes)=>{
  const bytes = new Uint8Array(frameBytes);
  const blob = new Blob([bytes], {type: "image/jpeg"});
  const url = URL.createObjectURL(blob);

  const img = document.getElementById("videoStream");
  img.src = url;

  // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
  img.onload = () => URL.revokeObjectURL(url);
});

// ì†ë„ ìƒíƒœ ë³€ìˆ˜
let currentSpeed = 0;  // ê¸°ë³¸ê°’ 0

// í‚¤ë³´ë“œ ì´ë²¤íŠ¸
window.addEventListener('keydown', (e)=>{
  if(e.key==='q'||e.key==='Q'){ socket.emit("control_cmd", "quit"); }
  else if(e.key==='ArrowRight'){ socket.emit("control_cmd", "turn_right"); }
  else if(e.key==='ArrowLeft'){ socket.emit("control_cmd", "turn_left"); }
  else if(e.key==='ArrowUp'){ currentSpeed += 1; socket.emit("control_cmd", "speed_up"); }
  else if(e.key==='ArrowDown'){ currentSpeed -= 1; socket.emit("control_cmd", "speed_down"); }
  else if(e.key===' '){ e.preventDefault(); socket.emit("control_cmd", "stop_resume"); }
  else if(e.key==='b'||e.key==='B'){ socket.emit("control_cmd", "toggle_backward"); }
});
window.addEventListener('keyup', (e)=>{
  if(e.key==='ArrowRight'||e.key==='ArrowLeft'){ socket.emit("control_cmd", "turn_stop"); }
});
</script>
</body>
</html>
